# ✅ EF Core Entity & Migration Regeneration Guide  
**Location:** `.github/copilot-entity-generation.md`  
**Purpose:** Instructions for GitHub Copilot or developers to regenerate EF Core entities, configurations, and migrations from MySQL database.

---

## ✅ 1. Database Connection

The updated MySQL database uses this connection string:

```
ConnectionStrings__downstairsdb = Server=localhost;Port=3306;Database=downstairs;Uid=root;Pwd=password;CharSet=utf8mb4;
```

---

## ✅ 2. Required Actions

Follow these steps when regenerating EF Core models and migrations:

### **Step 1 — Clean Up Existing Code**
- Remove all existing EF Core entities (`/Models`) and previous migrations.
- Remove or clear old configuration classes in `/EntityConfigurations`.

---

### **Step 2 — Scaffold New Models from Database**
Use EF Core database-first scaffolding to generate new entities and `DbContext` from the database schema.

---

### **Step 3 — Correct Data Type Mappings**

Apply the following data type rules during or after scaffolding:

#### **C# Type Mappings**
| MySQL Type                     | C# Type |
|--------------------------------|---------|
| UNSIGNED BIGINT / UNSIGNED INT | `long`  |
| `ulong` (if generated by EF)   | Replace with `long` |

#### **SQL Column Type Rules in Configuration (`IEntityTypeConfiguration<T>`)**
| MySQL Column         | Use in `.HasColumnType(...)` |
|----------------------|------------------------------|
| `smallint`           | `smallint unsigned`          |
| `tinyint`            | `tinyint unsigned`           |
| `decimal(8,2)`       | `decimal(8,2) unsigned`      |

Example inside a configuration file:

```csharp
builder.Property(x => x.Status).HasColumnType("tinyint unsigned");
builder.Property(x => x.Level).HasColumnType("smallint unsigned");
builder.Property(x => x.Price).HasColumnType("decimal(8,2) unsigned");
```

---

### **Step 4 — Apply Charset & Collation Globally**

In `DownstairsDbContext.OnModelCreating`:

```csharp
modelBuilder.UseCollation(DatabaseConstants.Collations.Unicode);
modelBuilder.HasCharSet(DatabaseConstants.CharSets.Utf8mb4);
modelBuilder.ApplyConfigurationsFromAssembly(typeof(DownstairsDbContext).Assembly);
```

In each `IEntityTypeConfiguration<T>` file:

```csharp
builder.UseCollation(DatabaseConstants.Collations.Unicode);
builder.HasCharSet(DatabaseConstants.CharSets.Utf8mb4);
```

---

### **Step 5 — Store Configuration Files in Separate Files**

- Each class implementing `IEntityTypeConfiguration<T>` must be placed in its own file.
- Suggested folder: `/EntityConfigurations/`.

```
/EntityConfigurations
   ProductConfiguration.cs
   OrderConfiguration.cs
   UserConfiguration.cs
```

---

### **Step 6 — Create Migration**
After entities and configurations are ready:

```
dotnet ef migrations add InitialCreate
```

---

### **Step 7 — Apply `.editorconfig` Formatting**
Run:

```
dotnet format
```

Ensure:
✔ Naming conventions  
✔ Indentation and spacing  
✔ Braces and layout rules are applied to all files  

---

### **Step 8 — Build Verification**
- Run `dotnet build`
- Ensure the solution compiles successfully and migrations work

---

### ✅ Done!

This file ensures consistency every time EF Core entities are regenerated or synchronized with the database schema.

---
